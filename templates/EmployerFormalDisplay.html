<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Browse Formal Jobs</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 80px 20px 20px;
      background: linear-gradient(135deg, #1f2c44, #3e5ba3);
      min-height: 100vh;
      color: #fff;
    }

    .header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .back-button {
      position: absolute;
      padding: 8px 16px;
      background: #556ee6;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.3s;
    }
    .back-button:hover {
      background: #3747a8;
    }

    h1 {
      text-align: center;
      flex-grow: 1;
      font-weight: 600;
      color: #fffbf7;
    }

    .filter-bar {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(8px);
    }

    .filter-bar label {
      font-weight: bold;
    }

    .filter-bar input,
    .filter-bar select {
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      outline: none;
      width: 150px;
      font-family: 'Poppins', sans-serif;
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
      box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
      transition: background 0.3s, box-shadow 0.3s;
    }
    .filter-bar input:focus,
    .filter-bar select:focus {
      background: rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 10px rgba(85, 110, 230, 0.7);
      color: #222;
    }

    .filter-bar option {
      color: #000;
    }

    .filter-bar button {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      background: #556ee6;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    .filter-bar button:hover {
      background: #3747a8;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
    }

    .job-card {
      background: rgba(255, 255, 255, 0.12);
      padding: 20px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-height: 180px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.2);
      backdrop-filter: blur(10px);
    }
    .job-card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 12px 28px rgba(0,0,0,0.35);
      background: rgba(255, 255, 255, 0.18);
      box-shadow:
        0 4px 30px rgb(0, 255, 179),

        inset 0 0 10px rgb(0, 255, 179);
    }
    .job-card h3 {
      margin: 0 0 12px 0;
      font-size: 1.3rem;
      font-weight: 600;
      color: #fff;
      letter-spacing: 0.6px;
    }
    .job-card p {
      margin: 6px 0;
      font-size: 0.95rem;
      color: #e5e5e5;
      line-height: 1.5;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .job-card p strong {
      color: #fff;
      font-weight: 600;
    }

    .job-details {
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.25);
      font-size: 0.9rem;
      line-height: 1.6;
      color: #dcdcdc;
      display: none;
    }
    .job-card.expanded .job-details {
      display: block;
      animation: fadeInDetails 0.3s ease-in;
    }

    @keyframes fadeInDetails {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .pagination {
      margin-top: 25px;
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .pagination button {
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      background: #556ee6;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    .pagination button:hover {
      background: #3747a8;
    }
    .pagination button:disabled {
      background: #999;
      cursor: not-allowed;
    }
    .pagination .active {
      background: #ff9800;
    }

    @media (max-width: 1200px) {
      .grid { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 800px) {
      .grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 500px) {
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
{% extends "base.html" %}
{% block content %}
  <div class="header">
    <a href="/employee/choice" class="back-button">‚Üê Back</a>
    <h1>Browse Formal Jobs</h1>
  </div>

  <div class="filter-bar">
    <label for="filterField">Field:</label>
    <select id="filterField">
      <option value="">Any</option>
      <option>Engineering</option>
      <option>IT</option>
      <option>Retail</option>
      <option>Education</option>
      <option>Finance</option>
      <option>Healthcare</option>
    </select>

    <label for="filterTitle">Job Title:</label>
    <select id="filterTitle">
      <option value="">Any</option>
      <option>Civil Engineer</option>
      <option>System Administrator</option>
      <option>Store Manager</option>
      <option>Teacher</option>
      <option>Principal</option>
      <option>Financial Analyst</option>
      <option>Medical Technician</option>
      <option>Software Developer</option>
      <option>Pharmacist</option>
      <option>Nurse</option>
      <option>Software Engineer</option>
      <option>Cashier</option>
      <option>Data Scientist</option>
      <option>Cybersecurity Specialist</option>
      <option>Mechanical Engineer</option>
      <option>Tutor</option>
      <option>Doctor</option>
      <option>Auditor</option>
      <option>Sales Associate</option>
      <option>Merchandiser</option>
      <option>Lecturer</option>
      <option>Accountant</option>
      <option>Investment Banker</option>
      <option>Electrical Engineer</option>
    </select>

    <label for="filterSalaryRange">Salary:</label>
    <select id="filterSalaryRange">
      <option value="">Any</option>
      <option value="5000-10000">5000 - 10000</option>
      <option value="10000-15000">10000 - 15000</option>
      <option value="15000-20000">15000 - 20000</option>
      <option value="20000-25000">20000 - 25000</option>
      <option value="25000-30000">25000 - 30000</option>
      <option value="30000-35000">30000 - 35000</option>
      <option value="35000-40000">35000 - 40000</option>
      <option value="40000+">40000+</option>
    </select>

    <label for="filterLocation">Location:</label>
    <select id="filterLocation">
      <option value="">Any</option>
      <option>Pretoria</option>
      <option>Durban</option>
      <option>Cape Town</option>
      <option>Port Elizabeth</option>
      <option>Johannesburg</option>
    </select>

    <button id="applyFilter">Apply</button>
    <button id="clearFilter">Clear</button>
  </div>

  <div class="grid" id="jobGrid"></div>
  <div class="pagination" id="pagination"></div>
{% endblock %}

{% block scripts %}

<script>
const jobGrid = document.getElementById('jobGrid');
const pagination = document.getElementById('pagination');

let jobs = {{ jobs|tojson|safe }};
let currentPage = 1;
const jobsPerPage = 8;
let activeFilters = {};

function parseSalaryRange(value) {
  if (!value) return [null, null];
  if (value.endsWith('+')) {
    return [parseInt(value), null];
  }
  const [min, max] = value.split('-').map(v => parseInt(v));
  return [min || null, max || null];
}

function renderJobs(filters = activeFilters, page = 1) {
  jobGrid.innerHTML = '';
  activeFilters = filters;

  let filteredJobs = jobs.filter(job => {
    if (filters.field && filters.field !== job.job_field) return false;
    if (filters.title && filters.title !== job.title) return false;
    if (filters.salaryMin != null && job.salary < filters.salaryMin) return false;
    if (filters.salaryMax != null && job.salary > filters.salaryMax) return false;
    if (filters.location && filters.location !== job.location) return false;
    return true;
  });

  const totalPages = Math.ceil(filteredJobs.length / jobsPerPage);
  if (page > totalPages) page = totalPages;
  if (page < 1) page = 1;
  currentPage = page;

  const start = (page - 1) * jobsPerPage;
  const end = start + jobsPerPage;
  const jobsToShow = filteredJobs.slice(start, end);

  if (jobsToShow.length === 0) {
    jobGrid.innerHTML = "<p style='color:#fff; grid-column: 1 / -1; text-align:center;'>No jobs found.</p>";
  } else {
    jobsToShow.forEach(job => {
      const card = document.createElement('div');
      card.className = 'job-card';
      card.innerHTML = `
        <h3>üíº ${job.title}</h3>
        <p><span>üìÇ</span><strong>Field:</strong> ${job.job_field || 'N/A'}</p>
        <p><span>üí∞</span><strong>Salary:</strong> R${job.salary}</p>
        <p><span>üìç</span><strong>Location:</strong> ${job.location || 'N/A'}</p>
        <div class="job-details">
          <p><strong>Description:</strong> ${job.description || ''}</p>
          <p><strong>Requirements:</strong> ${job.requirements || ''}</p>
        </div>`;
      card.addEventListener('click', () => card.classList.toggle('expanded'));
      jobGrid.appendChild(card);
    });
  }
  renderPagination(totalPages);
}

function renderPagination(totalPages) {
  pagination.innerHTML = '';
  if (totalPages <= 1) return;

  const prevBtn = document.createElement('button');
  prevBtn.textContent = 'Previous';
  prevBtn.disabled = currentPage === 1;
  prevBtn.addEventListener('click', () => renderJobs(activeFilters, currentPage - 1));
  pagination.appendChild(prevBtn);

  for (let i = 1; i <= totalPages; i++) {
    const pageBtn = document.createElement('button');
    pageBtn.textContent = i;
    if (i === currentPage) pageBtn.classList.add('active');
    pageBtn.addEventListener('click', () => renderJobs(activeFilters, i));
    pagination.appendChild(pageBtn);
  }

  const nextBtn = document.createElement('button');
  nextBtn.textContent = 'Next';
  nextBtn.disabled = currentPage === totalPages;
  nextBtn.addEventListener('click', () => renderJobs(activeFilters, currentPage + 1));
  pagination.appendChild(nextBtn);
}

document.getElementById('applyFilter').addEventListener('click', () => {
  const [salaryMin, salaryMax] = parseSalaryRange(filterSalaryRange.value);
  renderJobs({
    field: filterField.value || null,
    title: filterTitle.value || null,
    salaryMin: salaryMin,
    salaryMax: salaryMax,
    location: filterLocation.value || null
  }, 1);
});

document.getElementById('clearFilter').addEventListener('click', () => {
  filterField.value = '';
  filterTitle.value = '';
  filterSalaryRange.value = '';
  filterLocation.value = '';
  renderJobs({}, 1);
});

// Initial render
renderJobs({}, 1);
</script>

{% endblock %}
</body>
</html>
